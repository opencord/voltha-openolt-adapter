{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "f1ac3d35_f2f694f9",
        "filename": "internal/pkg/resourcemanager/resourcemanager.go",
        "patchSetId": 3
      },
      "lineNbr": 1083,
      "author": {
        "id": 1000127
      },
      "writtenOn": "2021-10-04T15:45:48Z",
      "side": 1,
      "message": "Didn\u0027t the earlier mechanism work?\nBut the cache is to be updated also before we return. One way to that is to still fetch the list of key/value with rsrcMgr.KVStore.List(ctx, path) and use the key from the list to clear the entries in the cache, while use the rsrcMgr.KVStore.DeleteWithPrefix with the entire data.",
      "revId": "86309a3099d68d84efb814abe3082964940a6cdd",
      "serverId": "2a2bfe1b-c5c2-48ed-9ac8-16438ab24388"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc7eaf56_a36fd2bc",
        "filename": "internal/pkg/resourcemanager/resourcemanager.go",
        "patchSetId": 3
      },
      "lineNbr": 1083,
      "author": {
        "id": 1000404
      },
      "writtenOn": "2021-10-04T16:03:18Z",
      "side": 1,
      "message": "The earlier mechanism did not delete the following entries:\nservice/voltha/voltha1_voltha1/openolt/{a6582428-51c8-4ffb-ba4a-606b264c3562}/onu_packetin/{0,1,16}/{0,0}\n\nservice/voltha/voltha1_voltha1/openolt/{a6582428-51c8-4ffb-ba4a-606b264c3562}/onu_packetin/{0,1,16}/{900,0}",
      "parentUuid": "f1ac3d35_f2f694f9",
      "revId": "86309a3099d68d84efb814abe3082964940a6cdd",
      "serverId": "2a2bfe1b-c5c2-48ed-9ac8-16438ab24388"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19eb052e_736dfd44",
        "filename": "internal/pkg/resourcemanager/resourcemanager.go",
        "patchSetId": 3
      },
      "lineNbr": 1083,
      "author": {
        "id": 1000404
      },
      "writtenOn": "2021-10-04T16:21:13Z",
      "side": 1,
      "message": "I believe DeletePacketInGemPortForOnu method can not be able to delete anything actually in any case since the key also includes vlan and priority fields. At the time we clear the UNI ports, we dont have the vlan and priority fields. \nWe may try to iterate over the map and find the related entries and delete those. Is that a good idea?",
      "parentUuid": "bc7eaf56_a36fd2bc",
      "revId": "86309a3099d68d84efb814abe3082964940a6cdd",
      "serverId": "2a2bfe1b-c5c2-48ed-9ac8-16438ab24388"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bbd25a37_687c9a92",
        "filename": "internal/pkg/resourcemanager/resourcemanager.go",
        "patchSetId": 3
      },
      "lineNbr": 1083,
      "author": {
        "id": 1000127
      },
      "writtenOn": "2021-10-04T23:47:00Z",
      "side": 1,
      "message": "I think we should clear the cache other the cache and the external DB will be out-of-sync. Also if the ONU comes back we may have stale data in cache for the same key causing issues later (since we read data from cache first before going to DB). So, yes we invalidate the cache by iterating out the key map and deleting the entries from the cache for the given key.",
      "parentUuid": "19eb052e_736dfd44",
      "revId": "86309a3099d68d84efb814abe3082964940a6cdd",
      "serverId": "2a2bfe1b-c5c2-48ed-9ac8-16438ab24388"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53d3b7fc_f14949ff",
        "filename": "internal/pkg/resourcemanager/resourcemanager.go",
        "patchSetId": 3
      },
      "lineNbr": 1083,
      "author": {
        "id": 1000127
      },
      "writtenOn": "2021-10-04T23:48:06Z",
      "side": 1,
      "message": "*otherwise the cache and the external DB will be out-of-sync",
      "parentUuid": "bbd25a37_687c9a92",
      "revId": "86309a3099d68d84efb814abe3082964940a6cdd",
      "serverId": "2a2bfe1b-c5c2-48ed-9ac8-16438ab24388"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6ac17f46_843833f1",
        "filename": "internal/pkg/resourcemanager/resourcemanager.go",
        "patchSetId": 3
      },
      "lineNbr": 1083,
      "author": {
        "id": 1000404
      },
      "writtenOn": "2021-10-05T15:46:07Z",
      "side": 1,
      "message": "This cache might be a huge one if the OLT is full, right? I propose having different functions for two different cases:\n1. if we clear because we lost a UNI, then iterate over the cache and find and delete the related entry.\n2. if we clear because we lost the parent device then clear the cache fully without iterating.\n\nI believe the same mechanism can be applied for other cases. But those should be addressed in a different patch. I\u0027ll try to cover only the option 1 in this patch.",
      "parentUuid": "53d3b7fc_f14949ff",
      "revId": "86309a3099d68d84efb814abe3082964940a6cdd",
      "serverId": "2a2bfe1b-c5c2-48ed-9ac8-16438ab24388"
    }
  ]
}